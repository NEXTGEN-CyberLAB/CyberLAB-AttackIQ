<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Attack Result — CyberLAB</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='attackiq.css') }}">
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="header-inner">
        <div>
          <h1>Result for {{ attack_name }}</h1>
          <p class="subtitle">Execution output rendered below. Use the tools to copy, download, or search.</p>
        </div>
        <a class="btn" href="{{ url_for('attacks') }}" title="Back to attacks">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h14M10 6l-6 6 6 6" stroke="white" stroke-width="1.5"/></svg>
          Back to Attacks
        </a>
      </div>

      <div class="toolbar">
        <button class="btn" type="button" onclick="copyResult()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="9" y="3" width="12" height="14" rx="2" stroke="white" stroke-width="1.5"/><rect x="3" y="7" width="12" height="14" rx="2" stroke="white" stroke-width="1.5"/></svg>
          Copy output
        </button>
        <button class="ghost" type="button" onclick="toggleWrap()">Toggle wrap</button>
        <button class="ghost" type="button" onclick="downloadResult()">Download .txt</button>
      </div>
    </header>

    <section class="panel">
      <div class="panel-head">
        <div class="panel-title">Execution log</div>
        <div class="controls">
          <label class="search" for="q">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.5"/><path d="M20 20l-3.5-3.5" stroke="currentColor" stroke-width="1.5"/></svg>
            <input id="q" type="search" placeholder="Find in output…" oninput="highlight()" />
          </label>
        </div>
      </div>
      <div class="result">
        <pre id="raw" class="wrap">{{ result }}</pre>
      </div>
    </section>

    <footer class="footer">CyberLAB Attack Simulator • Run Automated Attacks • Powered by AttackIQ.</footer>
  </div>

  <script>
    const pre = document.getElementById('raw');
    let wrapped = true;

    function copyResult(){
      const text = pre.textContent || '';
      navigator.clipboard.writeText(text).then(()=>{ toast('Output copied to clipboard'); });
    }
    function toggleWrap(){ wrapped = !wrapped; pre.classList.toggle('wrap', wrapped); }
    function downloadResult(){
      const name = ({{ attack_name|tojson }} || 'attack').toString().replace(/\s+/g,'_');
      const blob = new Blob([pre.textContent || ''], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `${name}_result.txt`;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
    }
    function highlight(){
      const q = document.getElementById('q').value.trim();
      if(!q){ pre.textContent = pre.textContent; return; }
      const text = pre.textContent;
      try{
        const safe = q.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const re = new RegExp(safe, 'gi');
        pre.innerHTML = text.replace(re, m => `<mark>${m}</mark>`);
      }catch(e){}
    }
    function toast(msg){
      const box = document.createElement('div');
      box.style.position = 'fixed'; box.style.right = '16px'; box.style.bottom = '16px';
      box.style.background = 'linear-gradient(135deg, rgba(14,57,34,.95), rgba(20,38,28,.95))';
      box.style.color = 'var(--success-fg)'; box.style.border = '1px solid var(--border)'; box.style.borderLeft = '6px solid var(--success-fg)';
      box.style.padding = '10px 12px'; box.style.borderRadius = '12px'; box.style.boxShadow = 'var(--shadow)'; box.textContent = msg;
      document.body.appendChild(box); setTimeout(()=> box.remove(), 2400);
    }
  </script>
</body>
</html>
